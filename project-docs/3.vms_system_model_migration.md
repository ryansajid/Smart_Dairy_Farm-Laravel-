Perfect ðŸ‘
Below is a **COMPLETE, CLEAN, BANK-GRADE Laravel 12 implementation** of **Models + Migrations** for your **Visitor Management System** including **Block / Unblock, RFID, Approval, Logs**.

Iâ€™ll structure it as:

1ï¸âƒ£ **Migrations (DB schema)**
2ï¸âƒ£ **Eloquent Models (relationships + casts)**

No UI, no controllers â€” only **core data layer**, production-ready.

---

# 1ï¸âƒ£ MIGRATIONS (Laravel 12)

---

## ðŸ”¹ visitors table

```php
// database/migrations/xxxx_xx_xx_create_visitors_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('visitors', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('phone')->index();
            $table->string('email')->nullable()->index();
            $table->text('address')->nullable();
            $table->boolean('is_blocked')->default(false);
            $table->timestamps();
            $table->softDeletes();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('visitors');
    }
};
```

---

## ðŸ”¹ visitor_blocks table (Block + Unblock Audit)

```php
// database/migrations/xxxx_xx_xx_create_visitor_blocks_table.php

return new class extends Migration {
    public function up(): void
    {
        Schema::create('visitor_blocks', function (Blueprint $table) {
            $table->id();
            $table->foreignId('visitor_id')->constrained()->cascadeOnDelete();
            $table->string('block_type'); // phone, email, rfid, manual
            $table->text('reason');
            $table->foreignId('blocked_by')->constrained('users');
            $table->timestamp('blocked_at');
            $table->foreignId('unblocked_by')->nullable()->constrained('users');
            $table->timestamp('unblocked_at')->nullable();
            $table->enum('status', ['blocked', 'unblocked'])->default('blocked');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('visitor_blocks');
    }
};
```

---

## ðŸ”¹ visit_types table

```php
// database/migrations/xxxx_xx_xx_create_visit_types_table.php

return new class extends Migration {
    public function up(): void
    {
        Schema::create('visit_types', function (Blueprint $table) {
            $table->id();
            $table->string('name')->unique();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('visit_types');
    }
};
```

---

## ðŸ”¹ visits table

```php
// database/migrations/xxxx_xx_xx_create_visits_table.php

return new class extends Migration {
    public function up(): void
    {
        Schema::create('visits', function (Blueprint $table) {
            $table->id();
            $table->foreignId('visitor_id')->constrained()->cascadeOnDelete();
            $table->foreignId('meeting_user_id')->constrained('users');
            $table->foreignId('visit_type_id')->constrained();
            $table->text('purpose');
            $table->dateTime('schedule_time');
            $table->enum('status', [
                'pending',
                'approved',
                'rejected',
                'cancelled',
                'completed'
            ])->default('pending');
            $table->timestamp('approved_at')->nullable();
            $table->text('rejected_reason')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('visits');
    }
};
```

---

## ðŸ”¹ rfids table

```php
// database/migrations/xxxx_xx_xx_create_rfids_table.php

return new class extends Migration {
    public function up(): void
    {
        Schema::create('rfids', function (Blueprint $table) {
            $table->id();
            $table->string('tag_uid')->unique();
            $table->boolean('is_active')->default(true);
            $table->timestamp('assigned_at')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('rfids');
    }
};
```

---

## ðŸ”¹ visit_logs table (Check-in / Check-out)

```php
// database/migrations/xxxx_xx_xx_create_visit_logs_table.php

return new class extends Migration {
    public function up(): void
    {
        Schema::create('visit_logs', function (Blueprint $table) {
            $table->id();
            $table->foreignId('visit_id')->constrained()->cascadeOnDelete();
            $table->foreignId('rfid_id')->constrained();
            $table->timestamp('checkin_time')->nullable();
            $table->timestamp('checkout_time')->nullable();
            $table->integer('total_minutes')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('visit_logs');
    }
};
```

---

## ðŸ”¹ notifications table (Email / SMS log)

```php
// database/migrations/xxxx_xx_xx_create_notifications_table.php

return new class extends Migration {
    public function up(): void
    {
        Schema::create('notifications', function (Blueprint $table) {
            $table->id();
            $table->foreignId('visit_id')->constrained()->cascadeOnDelete();
            $table->string('channel'); // email / sms
            $table->timestamp('sent_at');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('notifications');
    }
};
```

---

# 2ï¸âƒ£ ELOQUENT MODELS

---

## ðŸ”¹ Visitor Model

```php
// app/Models/Visitor.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Visitor extends Model
{
    use SoftDeletes;

    protected $fillable = [
        'name', 'phone', 'email', 'address', 'is_blocked'
    ];

    protected $casts = [
        'is_blocked' => 'boolean',
    ];

    public function visits()
    {
        return $this->hasMany(Visit::class);
    }

    public function blocks()
    {
        return $this->hasMany(VisitorBlock::class);
    }
}
```

---

## ðŸ”¹ VisitorBlock Model

```php
// app/Models/VisitorBlock.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class VisitorBlock extends Model
{
    protected $fillable = [
        'visitor_id',
        'block_type',
        'reason',
        'blocked_by',
        'blocked_at',
        'unblocked_by',
        'unblocked_at',
        'status'
    ];

    protected $casts = [
        'blocked_at' => 'datetime',
        'unblocked_at' => 'datetime',
    ];

    public function visitor()
    {
        return $this->belongsTo(Visitor::class);
    }

    public function blocker()
    {
        return $this->belongsTo(User::class, 'blocked_by');
    }

    public function unblocker()
    {
        return $this->belongsTo(User::class, 'unblocked_by');
    }
}
```

---

## ðŸ”¹ Visit Model

```php
// app/Models/Visit.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Visit extends Model
{
    protected $fillable = [
        'visitor_id',
        'meeting_user_id',
        'visit_type_id',
        'purpose',
        'schedule_time',
        'status',
        'approved_at',
        'rejected_reason'
    ];

    protected $casts = [
        'schedule_time' => 'datetime',
        'approved_at' => 'datetime',
    ];

    public function visitor()
    {
        return $this->belongsTo(Visitor::class);
    }

    public function meetingUser()
    {
        return $this->belongsTo(User::class, 'meeting_user_id');
    }

    public function type()
    {
        return $this->belongsTo(VisitType::class, 'visit_type_id');
    }

    public function log()
    {
        return $this->hasOne(VisitLog::class);
    }
}
```

---

## ðŸ”¹ VisitLog Model

```php
// app/Models/VisitLog.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class VisitLog extends Model
{
    protected $fillable = [
        'visit_id',
        'rfid_id',
        'checkin_time',
        'checkout_time',
        'total_minutes'
    ];

    protected $casts = [
        'checkin_time' => 'datetime',
        'checkout_time' => 'datetime',
    ];

    public function visit()
    {
        return $this->belongsTo(Visit::class);
    }

    public function rfid()
    {
        return $this->belongsTo(Rfid::class);
    }
}
```

---

## ðŸ”¹ RFID Model

```php
// app/Models/Rfid.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Rfid extends Model
{
    protected $fillable = [
        'tag_uid', 'is_active', 'assigned_at'
    ];

    protected $casts = [
        'is_active' => 'boolean',
        'assigned_at' => 'datetime',
    ];
}
```

---

## ðŸ”¹ VisitType Model

```php
// app/Models/VisitType.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class VisitType extends Model
{
    protected $fillable = ['name'];
}
```

---

## ðŸ”¹ Notification Model

```php
// app/Models/Notification.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Notification extends Model
{
    protected $fillable = [
        'visit_id',
        'channel',
        'sent_at'
    ];

    protected $casts = [
        'sent_at' => 'datetime',
    ];

    public function visit()
    {
        return $this->belongsTo(Visit::class);
    }
}
```

---


