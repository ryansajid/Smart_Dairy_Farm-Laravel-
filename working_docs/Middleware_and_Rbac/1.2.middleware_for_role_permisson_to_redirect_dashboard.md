Perfect ğŸ‘
Youâ€™re using **Jetstream + Spatie Permission**, so letâ€™s design this **clean, production-ready, and scalable**.

Iâ€™ll split it into **2 clear parts**:

1ï¸âƒ£ **Role-based dashboard redirect (with fallback to staff)**
2ï¸âƒ£ **Permission-based route protection for Visitor Management (CRUD)**

---

# âœ… PART 1: Role-Based Dashboard Redirect (Jetstream Friendly)

### ğŸ¯ Requirement recap

* `admin` â†’ admin dashboard
* `receptionist` â†’ receptionist dashboard
* `visitor` â†’ visitor dashboard
* â— Any **other role** â†’ staff dashboard
* Must work with **Jetstream login**

---

## ğŸ”¹ Step 1: Create Redirect Middleware

```bash
php artisan make:middleware RedirectUserByRole
```

### `app/Http/Middleware/RedirectUserByRole.php`

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;

class RedirectUserByRole
{
    public function handle(Request $request, Closure $next)
    {
        $user = auth()->user();

        if (!$user) {
            return redirect()->route('login');
        }

        // Priority-based redirect
        if ($user->hasRole('admin')) {
            return redirect()->route('admin.dashboard');
        }

        if ($user->hasRole('receptionist')) {
            return redirect()->route('receptionist.dashboard');
        }

        if ($user->hasRole('visitor')) {
            return redirect()->route('visitor.dashboard');
        }

        // ğŸ”´ Any other role â†’ staff dashboard
        if ($user->hasAnyRole($user->getRoleNames())) {
            return redirect()->route('staff.dashboard');
        }

        return redirect()->route('login');
    }
}
```

---

## ğŸ”¹ Step 2: Register Middleware

`app/Http/Kernel.php`

```php
protected $routeMiddleware = [
    'role.redirect' => \App\Http\Middleware\RedirectUserByRole::class,
];
```

---

## ğŸ”¹ Step 3: Apply Middleware to Jetstream Dashboard Route

Jetstream uses `/dashboard` by default.

```php
Route::get('/dashboard', function () {
    return view('dashboard');
})->middleware(['auth', 'verified', 'role.redirect'])
  ->name('dashboard');
```

âœ… Now **after login**, users auto-redirect to the correct dashboard.

---

## ğŸ”¹ Step 4: Define Dashboard Routes

```php
Route::middleware(['auth', 'role:admin'])->group(function () {
    Route::get('/admin/dashboard', fn () => view('admin.dashboard'))
        ->name('admin.dashboard');
});

Route::middleware(['auth', 'role:receptionist'])->group(function () {
    Route::get('/receptionist/dashboard', fn () => view('receptionist.dashboard'))
        ->name('receptionist.dashboard');
});

Route::middleware(['auth', 'role:visitor'])->group(function () {
    Route::get('/visitor/dashboard', fn () => view('visitor.dashboard'))
        ->name('visitor.dashboard');
});

Route::middleware(['auth'])->group(function () {
    Route::get('/staff/dashboard', fn () => view('staff.dashboard'))
        ->name('staff.dashboard');
});
```

---

# âœ… PART 2: Permission-Based Route Access (Visitor Management CRUD)

ğŸ¯ **Important rule**

* Visitor Management CRUD routes
* Accessible by **permission**, NOT role
* âŒ Visitors must NOT access

---

## ğŸ”¹ Step 1: Create Permissions (Once)

```php
php artisan permission:create-permission manage-visitors
php artisan permission:create-permission create-visitor
php artisan permission:create-permission edit-visitor
php artisan permission:create-permission delete-visitor
```

Assign permissions to roles:

```php
$admin->givePermissionTo(['manage-visitors']);
$staff->givePermissionTo(['manage-visitors']);
$receptionist->givePermissionTo(['create-visitor', 'edit-visitor']);
```

âŒ Do **NOT** assign any of these to `visitor` role.

---

## ğŸ”¹ Step 2: Protect Routes Using Permission Middleware

```php
Route::middleware(['auth', 'permission:manage-visitors'])->group(function () {

    Route::get('/visitors', [VisitorController::class, 'index']);
    Route::post('/visitors', [VisitorController::class, 'store']);
    Route::put('/visitors/{id}', [VisitorController::class, 'update']);
    Route::delete('/visitors/{id}', [VisitorController::class, 'destroy']);

});

Route::get('/visitors', [VisitorController::class, 'index'])
    ->middleware(['auth', 'permission:manage-visitors']);

Route::post('/visitors', [VisitorController::class, 'store'])
    ->middleware(['auth', 'permission:create-visitor']);

Route::put('/visitors/{id}', [VisitorController::class, 'update'])
    ->middleware(['auth', 'permission:edit-visitor']);

Route::delete('/visitors/{id}', [VisitorController::class, 'destroy'])
    ->middleware(['auth', 'permission:delete-visitor']);

```

âœ… Now:

* Admin / Staff â†’ allowed
* Receptionist â†’ only what you allow
* Visitor â†’ âŒ blocked automatically

---

## ğŸ”¹ Step 3: Hide Menu Items (Very Important UX)

In Blade:

```blade
@can('manage-visitors')
    <li>
        <a href="{{ route('visitors.index') }}">Visitor Management</a>
    </li>
@endcan
```

OR

```blade
@hasanyrole('admin|staff|receptionist')
    ...
@endhasanyrole
```

---

# ğŸ† Final Architecture (Best Practice)

| Feature          | Method                |
| ---------------- | --------------------- |
| Login Redirect   | Custom Middleware     |
| Dashboard Access | Role Middleware       |
| CRUD Security    | Permission Middleware |
| Menu Visibility  | `@can` / `@role`      |

---

If you want, next I can:

* Convert this to **Policy-based authorization**
* Add **API permissions**
* Add **multi-role priority logic**
* Secure **Jetstream Teams**

Just tell me ğŸ”¥
